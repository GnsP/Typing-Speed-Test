(function(A){function K(){for(var b=new D,d=arguments.length,c=Array(d),a=0;a<d;a++)c[a]=arguments[a];var d=!0,a=!1,f=void 0;try{for(var g=c[Symbol.iterator](),e;!(d=(e=g.next()).done);d=!0)b.append(new D(e.value))}catch(h){a=!0,f=h}finally{try{!d&&g["return"]&&g["return"]()}finally{if(a)throw f;}}b.normalize();return b.path}function S(b){return(new D(b)).dirname}function X(b){return(new D(b)).basename}function bb(b){return(new D(b)).extname}function ma(b){return b}function cb(b,d,c){switch(c.length){case 0:return b.call(d);
case 1:return b.call(d,c[0]);case 2:return b.call(d,c[0],c[1]);case 3:return b.call(d,c[0],c[1],c[2])}return b.apply(d,c)}function db(b,d,c){d=na(void 0===d?b.length-1:d,0);return function(){for(var a=arguments,f=-1,g=na(a.length-d,0),e=Array(g);++f<g;)e[f]=a[d+f];f=-1;for(g=Array(d+1);++f<d;)g[f]=a[f];g[d]=c(e);return cb(b,this,g)}}function eb(b){return function(){return b}}function Y(b){if(null==b)return void 0===b?"[object Undefined]":"[object Null]";b=Object(b);var d;if(oa&&oa in b){var c=fb.call(b,
N),a=b[N];try{b[N]=void 0,d=!0}catch(g){}var f=gb.call(b);d&&(c?b[N]=a:delete b[N]);d=f}else d=hb.call(b);return d}function pa(b){var d=typeof b;return null!=b&&("object"==d||"function"==d)}function qa(b){if(!pa(b))return!1;b=Y(b);return"[object Function]"==b||"[object GeneratorFunction]"==b||"[object AsyncFunction]"==b||"[object Proxy]"==b}function ib(b){if(null!=b){try{return jb.call(b)}catch(d){}return b+""}return""}function x(b,d){return kb(db(b,d,ma),b+"")}function ra(b){return x(function(d,
c){var a=sa(function(a,c){var f=this;return b(d,function(c,b){c.apply(f,a.concat([b]))},c)});return c.length?a.apply(this,c):a})}function ta(b){return"number"==typeof b&&-1<b&&0==b%1&&9007199254740991>=b}function Z(b){return null!=b&&ta(b.length)&&!qa(b)}function H(){}function O(b){return function(){if(null!==b){var d=b;b=null;d.apply(this,arguments)}}}function aa(b){return null!=b&&"object"==typeof b}function ua(b){return aa(b)&&"[object Arguments]"==Y(b)}function lb(){return!1}function mb(b){return aa(b)&&
ta(b.length)&&!!q[Y(b)]}function nb(b){return function(d){return b(d)}}function ob(b){if(Z(b)){var d=pb(b),c=!d&&qb(b),a=!d&&!c&&rb(b),f=!d&&!c&&!a&&sb(b);if(d=d||c||a||f){for(var c=b.length,g=String,e=-1,h=Array(c);++e<c;)h[e]=g(e);c=h}else c=[];var g=c.length,l;for(l in b)(e=!tb.call(b,l))||!(e=d)||(e="length"==l||a&&("offset"==l||"parent"==l)||f&&("buffer"==l||"byteLength"==l||"byteOffset"==l))||(e=l,h=g,h=null==h?9007199254740991:h,e=!!h&&("number"==typeof e||ub.test(e))&&-1<e&&0==e%1&&e<h),e||
c.push(l);b=c}else if(l=b&&b.constructor,b===("function"==typeof l&&l.prototype||vb)){l=[];for(a in Object(b))wb.call(b,a)&&"constructor"!=a&&l.push(a);b=l}else b=xb(b);return b}function yb(b){var d=-1,c=b.length;return function(){return++d<c?{value:b[d],key:d}:null}}function zb(b){var d=-1;return function(){var c=b.next();if(c.done)return null;d++;return{value:c.value,key:d}}}function Ab(b){var d=ob(b),c=-1,a=d.length;return function(){var f=d[++c];return c<a?{value:b[f],key:f}:null}}function Bb(b){if(Z(b))return yb(b);
var d=ba&&b[ba]&&b[ba]();return d?zb(d):Ab(b)}function ca(b){return function(){if(null===b)throw Error("Callback was already called.");var d=b;b=null;d.apply(this,arguments)}}function va(b){return function(d,c,a){function f(c,f){--l;if(c)h=!0,a(c);else{if(f===Cb||h&&0>=l)return h=!0,a(null);g()}}function g(){for(;l<b&&!h;){var d=e();if(null===d){h=!0;0>=l&&a(null);break}l+=1;c(d.value,d.key,ca(f))}}a=O(a||H);if(0>=b||!d)return a(null);var e=Bb(d),h=!1,l=0;g()}}function wa(b,d,c,a){va(d)(b,c,a)}function da(b,
d){return function(c,a,f){return b(c,d,a,f)}}function Db(b,d,c){function a(a){a?c(a):++g===e&&c(null)}c=O(c||H);var f=0,g=0,e=b.length;for(0===e&&c(null);f<e;f++)d(b[f],f,ca(a))}function xa(b,d,c,a){a=O(a||H);d=d||[];var f=[],g=0;b(d,function(a,b,d){var e=g++;c(a,function(a,c){f[e]=c;d(a)})},function(c){a(c,f)})}function ya(b){return function(d,c,a,f){return b(va(c),d,a,f)}}function Eb(b,d){for(var c=-1,a=null==b?0:b.length;++c<a&&!1!==d(b[c],c,b););return b}function Fb(b,d){for(var c=-1,a=null==
b?0:b.length,f=Array(a);++c<a;)f[c]=d(b[c],c,b);return f}function za(b){setTimeout(b,0)}function Aa(b){return x(function(d,c){b(function(){d.apply(null,c)})})}function B(){this.head=this.tail=null;this.length=0}function Gb(b,d,c,a){a=O(a||H);Hb(b,function(a,b,e){c(d,a,function(a,c){d=c;e(a)})},function(c){a(c,d)})}function Ba(b){return x(function(d,c){d.apply(null,c.concat([x(function(a,c){"object"===typeof console&&(a?console.error&&console.error(a):console[b]&&Eb(c,function(a){console[b](a)}))})]))})}
function Ib(b){return function(d){return null==d?void 0:d[b]}}function Jb(b,d,c){c=ca(c||H);if(!b())return c(null);var a=x(function(f,g){if(f)return c(f);if(b())return d(a);c.apply(null,[null].concat(g))});d(a)}function ea(b,d){if(!b)throw console.log(d),Error(d);}function fa(b,d,c,a){c.syncLock||a("can _def/_let only inside a _begin/_sync block");b instanceof k&&b.startsWith("@")&&(b=c.get(b));b instanceof m&&Kb.equal(b.car)?(b.ctx="set",n(b,c,function(b,g,e,h){n(d,c,function(b,f,d,e){a(b,c,null,
h(e))})})):b instanceof m?n(d,c,function(f,d,e,h){h instanceof m?ga(h,[],c,function(f,d,e,g){L(g,32,P(c),function(f,d){for(var e=b,g=m.list(d);e instanceof m;)fa(e.car,g.car,c,function(c){c&&a(c)}),e=e.cdr,g=g.cdr;null!==e&&fa(e,g,c,function(c){c&&a(c)});a(null,c,null,h)})}):a("LValue : "+m.stringify(b)+" RValue : "+m.stringify(h)+" <Expected a List as the RValue>")}):b instanceof k?n(d,c,function(f,d,e,h){c.bind(b,h)?a(null,c,null,h):a("can _def/_let only inside a _begin/_sync block")}):a(""+m.stringify(b)+
"is not a valid LValue, Symbols, List of Symbols and References are the only valid LValues")}function ga(b,d,c,a){for(;b instanceof m;)d.push(b.car),b=b.cdr;null!==b?n(b,c,function(b,g,e,h){h instanceof m?ga(h,d,c,a):a(b,c,null,d)}):a(null,c,null,d)}function n(b,d){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Mb();b instanceof k?Nb.equal(b)?c(null,d,null,d):Ob.equal(b)?c(null,d,null,d.collection):Pb.equal(b)?c(null,d,null,null):Qb.equal(b)?c(null,d,null,!0):Rb.equal(b)?c(null,d,null,
!1):d.getAsync(b,c):b instanceof m?ga(b,[],d,function(a,f,d,e){Sb.equal(e[0])?c(null,f,null,e[1]):Tb.equal(e[0])?n(e[1],f,function(a,b,f,d){a?c(a):n(d,b,c)}):Ub.equal(e[0])?function(){var a=e[2];n(e[1],f,function(b,f,d,e){n(a,f,function(a,b,f,d){a=m.cons(e,d);c(null,b,null,a)})})}():Ca.equal(e[0])||Da.equal(e[0])?n(e[1],f,function(a,b,f,d){d instanceof m?(Ca.equal(e[0])&&c(null,b,null,d.car),Da.equal(e[0])&&c(null,b,null,d.cdr)):c(null,b,null,null)}):Vb.equal(e[0])?(a=e.slice(1),L(a,32,P(f),function(a,
b){c(a,f,null,new z(b))})):Ea.equal(e[0])||Wb.equal(e[0])?function(){var a=e[1],b=e[2];n(a,f,function(d,g,h,l){var r=z.isSequence(l);l instanceof Array||r?function(){var a=l;r&&(a=l.arr);var d=[],g=0,h=!0,t=!1,k=void 0;try{for(var w=a[Symbol.iterator](),E;!(h=(E=w.next()).done);h=!0)d.push({index:g,val:E.value}),g++}catch(Xb){t=!0,k=Xb}finally{try{!h&&w["return"]&&w["return"]()}finally{if(t)throw k;}}n(b,f,function(a,g,h,l){l instanceof Function?(a=function(a,c){u(l,null,f,function(a,b,f,d){c(a,d)},
a.val,a.index)},Ea.equal(e[0])?L(d,32,a,function(a,b){r?c(a,f,null,new z(b)):c(a,f,null,b)}):Yb(d,32,a,function(a,b){var d=[],e=!0,g=!1,h=void 0;try{for(var l=b[Symbol.iterator](),t;!(e=(t=l.next()).done);e=!0)d.push(t.value.val)}catch(Zb){g=!0,h=Zb}finally{try{!e&&l["return"]&&l["return"]()}finally{if(g)throw h;}}r?c(a,f,null,new z(d)):c(a,f,null,d)})):c(m.stringify(b)+" is not a Function")})}():c(m.stringify(a)+" is not an Array or Sequence")})}():$b.equal(e[0])?function(){var a=e.slice(1),d=b.ctx;
null===b.ctx&&(d="get");L(a,32,P(f),function(a,b){var e=new (Function.prototype.bind.apply(ac,[null].concat([d],C(b))));c(a,f,null,e.value)})}():bc.equal(e[0])?function(){var a=e[2],b=e[3];n(e[1],f,function(d,f,e,g){n(g?a:b,f,c)})}():cc.equal(e[0])?function(){var a=e[2];n(e[1],f,function(b,d,e,g){b?(d=new y(null,null,f),d.syncAndBind(dc,b),n(a,d,c)):c(null,d,null,g)})}():ec.equal(e[0])||fc.equal(e[0])?fa(e[1],e[2],f,c):gc.equal(e[0])||hc.equal(e[0])?function(){var a=e[1],b=e[2];a instanceof k&&a.startsWith("@")&&
(a=f.get(a));n(b,f,function(b,d,e,g){f.find(a).bind(a,g)?c(null,f,null,g):c("can _assign!/_set! only inside a _begin/_sync block")})}():ic.equal(e[0])?function(){var a=e[2];n(e[1],f,function(b,d,e,g){n(a,f,function(a,b,d,e){g instanceof Array||z.isSequence(g)||I.isStream(g)?(g.push(e),c(null,f,null,g)):c(new F("Can _push to Arrays, Sequences and Streams"))})})}():jc.equal(e[0])||Fa.equal(e[0])?(a=e[1],d=e[2],Fa.equal(e[0])?c(null,f,null,{__itype__:"specialform",func:Ga(a,d,f)}):c(null,f,null,Ga(a,
d,f))):kc.equal(e[0])?function(){var a=e[2];n(e[1],f,function(b,d,e,g){b=f.rho.accept(g,a);b instanceof F?c(b):c(null,f,null,f)})}():Ha.equal(e[0])||lc.equal(e[0])||ia.equal(e[0])||mc.equal(e[0])?function(){var a=ia.equal(e[0]),b=f,b=Ha.equal(e[0])?new y(null,null,f):ia.equal(e[0])?new y(null,null,f,!0):f,d=!1;b.syncLock||(d=!0,b.sync());var g=e.slice(1),k=0;Jb(function(){return k<g.length},function(a){n(g[k],b,function(c,b,d,f){k+=1;a(c,f)})},function(e,g){d&&b.unsync();a?c(e,f,null,b.collection.obj):
c(e,b,null,g)})}():nc.equal(e[0])?function(){var a=e[1],b=e.slice(2);n(a,f,function(a,d,e,g){c(a,f,null,new I(function(a){for(var c=Array(b.length),d=[],e=b.length,h=function(h){d.push(!1);n(b[h],f,function(b,l,r,t){c[h]=t;null!==t&&void 0!==t?d[h]||(d[h]=!0,e--):d[h]&&(d[h]=!1,e++);0===e&&g.apply(void 0,[b,f,function(c,b,d,f){a(f)}].concat(C(c)))})},l=0;l<b.length;l++)h(l)},f))})}():oc.equal(e[0])?function(){var a=e[1],b=e[2];n(a,f,function(d,e,g,h){I.isStream(h)?(e=new I(function(a){h.addcb(function(c,
d,e,g){n(b,f,function(c,b,d,f){null!==f&&void 0!==f&&a(f)})})},f),c(d,f,null,e)):c("_on expects a Stream, "+m.stringify(a)+" is not a Stream")})}():pc.equal(e[0])?n(e[1],f,function(a,b,d,e){I.isStream(e)?c(null,f,null,e.value):e instanceof Array?c(null,f,null,e.shift()):z.isSequence(e)?c(null,f,null,e.pull()):c(new F("can pull from Streams, Arrays and Sequences"))}):qc.equal(e[0])?n(e[1],f,function(a,b,d,e){e instanceof Array||z.isSequence(e)?c(null,f,null,e.pop()):c(new F("can pop from Arrays and Sequences"))}):
rc.equal(e[0])?function(){var a=e[1];n(a,f,function(b,d,e,g){I.isStream(g)?(g.addcb(sc()),c(null,f,null,null)):c("_do expects a Stream, "+m.stringify(a)+" is not a Stream")})}():Ia.equal(e[0])||tc.equal(e[0])?function(){var a=f.get(Ia);n(e[1],f,function(b,d,e,g){u(a,b,f,c,g)})}():uc.equal(e[0])?function(){var a=f.get(e[0]);vc.equal(e[1])?c(null,f,null," Ironscript Beta (1.2.1)\n Believe it or not we are about 30 times slower than JS !!!\n Therefore only a fool would use Ironscript to do trivial stuff.\n It is designed to be used as a syntactical abstraction over JS,\n It is recommended that you use the @{ ... }@ blocks to write the\n performance critical parts of your apllication in JS. Use Ironscript\n to define the asynchronous data and control flow among these \n parts written in JS."):
n(e[1],f,function(d,g,h,k){d=null;b.cdr.cdr&&(d=e[2]);n(d,f,function(b,d,e,g){u(a,b,f,c,k,g)})})}():wc.equal(e[0])?n(e[1],f,function(a,b,d,e){e instanceof Function&&(e.isVolatile=!0);c(a,f,null,e)}):n(e[0],f,function(a,d,f,g){y.isEnv(g)?(a=g.rho.reduce(b.cdr,d),null===a?n(m.list(e.slice(1)),d,c):n(a,d,c)):I.isStream(g)?(g.addcb(c),c(a,d,null,g.value)):g instanceof Object&&"specialform"===g.__itype__?(g=g.func,a=e.slice(1),g.apply(void 0,[null,d,c].concat(C(a)))):g instanceof Function?(a=e.slice(1),
f=P(d),g.isVolatile&&(f=P(d,!0)),L(a,64,f,function(a,b){g.apply(void 0,[a,d,c].concat(C(b)))})):c(null,d,null,b)})}):c(null,d,null,b)}function Ga(b,d,c){var a=y.clone(c);c.syncLock&&a.sync();return function(c,g,e){for(var f=arguments.length,l=Array(3<f?f-3:0),k=3;k<f;k++)l[k-3]=arguments[k];c&&e(c);u(n,d,new y(b,m.list(l),a),e)}}function xc(b,d,c,a){b&&c(b);c(null,d,null,function(c,b,d){for(var f=arguments.length,e=Array(3<f?f-3:0),g=3;g<f;g++)e[g-3]=arguments[g];f=a.apply(void 0,e);d(null,b,null,
f)})}function Ja(b){return function(d,c,a){for(var f=arguments.length,g=Array(3<f?f-3:0),e=3;e<f;e++)g[e-3]=arguments[e];f=b.apply(void 0,g);a(null,c,null,f)}}function yc(b){return function(d,c,a){for(var f=arguments.length,g=Array(3<f?f-3:0),e=3;e<f;e++)g[e-3]=arguments[e];var h=!1;b.apply(void 0,[function(b){h||(a(null,c,null,b),h=!0)},function(b){h||(a(b,c,null,null),h=!0)},function(a){d&&a(d)},function(b){a(null,c,null,b)},c.par].concat(g))}}function zc(b,d,c,a,f){f||(f="unnamed");b=new M({name:f,
buffer:a});u(n,b.parse(),d,function(a,b,f,l){c&&u(c,a,d,null,null)})}function Ac(b,d,c){d||(d="unnamed");console.time("Runtime");b=new M({name:d,buffer:b});n(b.parse(),c,function(a){if(a)throw a;})}function Bc(){for(var b="",d=arguments.length,c=Array(d),a=0;a<d;a++)c[a]=arguments[a];var d=!0,a=!1,f=void 0;try{for(var g=c[Symbol.iterator](),e;!(d=(e=g.next()).done);d=!0)var h=e.value,b=h instanceof m?b+(m.stringify(h)+" "):h instanceof Function?b+"[Function] ":h instanceof Object&&"collection"===
h.__itype__?b+(JSON.stringify(h.obj)+" "):h instanceof Object&&"sequence"===h.__itype__?b+(JSON.stringify(h.arr)+" "):h instanceof Object&&"ironsymbol"===h.type?b+(h.symbol+" "):"object"===("undefined"===typeof h?"undefined":G(h))?b+(JSON.stringify(h)+" "):b+(h+" ")}catch(l){a=!0,f=l}finally{try{!d&&g["return"]&&g["return"]()}finally{if(a)throw f;}}console.log(b)}function Cc(b){var d=new Map;return function(c,a,f,g,e){var h=a.get(Ka),l=a.getc("__base_dir__"),t=a.getc("__include_dir__"),r=a.getc("__path_utils__"),
w=r.join,q=r.dirname,r=r.basename,p=null,v=new k("_all"),p=g.endsWith(".is")?w(l,q(g)):w(t,q(g)),x=w(p,r(g));if(d.has(x)){c=d.get(x);if(e)if(e instanceof m)for(;e instanceof m;)a.syncAndBind(e.car,c.get(e.car)),e=e.cdr;else v.equal(e)&&(a.map=new Map([].concat(C(a.map),C(c.map))));u(f,null,a,null,c)}else a.defc("__base_dir__",p),u(h,c,a,function(c,h,k,t){a.defc("__base_dir__",l);c=new M({name:g,buffer:t});h=new y(null,null,b);h.defc("__base_dir__",p);u(n,c.parse(),h,function(b,c,g,h){d.set(x,c);if(e)if(e instanceof
m)for(;e instanceof m;)a.syncAndBind(e.car,c.get(e.car)),e=e.cdr;else v.equal(e)&&(a.map=new Map([].concat(C(a.map),C(c.map))));u(f,null,a,null,c)})},r(g))}}function Dc(b){var d=b.get(Ka),c=new Map,a=null;return function(b,g,e,h){var f=g.getc("__base_dir__"),k=g.getc("__include_dir__"),r=g.getc("__path_utils__"),w=r.join,m=r.dirname,r=r.basename,q=null,q=h.endsWith(".is")?w(f,m(h)):w(k,m(h));g.defc("__base_dir__",q);var p=w(q,r(h));c.has(p)?(a=c.get(p),b=new M({name:h,buffer:a}),u(n,b.parse(),g,function(a,
b,c,d){b.defc("__base_dir__",f);u(e,null,b,null,null)})):u(d,b,g,function(a,b,d,l){c.set(p,l);a=new M({name:h,buffer:l});u(n,a.parse(),g,function(a,b,c,d){b.defc("__base_dir__",f);u(e,null,b,null,null)})},r(h))}}function Ec(b,d){var c=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript";a.src=b;var f=function(){d(a)};a.onreadystatechange=f;a.onload=f;c.appendChild(a)}var G="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:
function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};(function(){function b(b){this.value=b}function d(c){function a(f,e){try{var g=c[f](e),h=g.value;h instanceof b?Promise.resolve(h.value).then(function(b){a("next",b)},function(b){a("throw",b)}):d(g.done?"return":"normal",g.value)}catch(w){d("throw",w)}}function d(b,c){switch(b){case "return":g.resolve({value:c,done:!0});break;case "throw":g.reject(c);break;default:g.resolve({value:c,done:!1})}(g=
g.next)?a(g.key,g.arg):e=null}var g,e;this._invoke=function(b,c){return new Promise(function(d,f){var h={key:b,arg:c,resolve:d,reject:f,next:null};e?e=e.next=h:(g=e=h,a(b,c))})};"function"!==typeof c["return"]&&(this["return"]=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(d.prototype[Symbol.asyncIterator]=function(){return this});d.prototype.next=function(b){return this._invoke("next",b)};d.prototype["throw"]=function(b){return this._invoke("throw",b)};d.prototype["return"]=function(b){return this._invoke("return",
b)};return{wrap:function(b){return function(){return new d(b.apply(this,arguments))}},await:function(c){return new b(c)}}})();var p=function(b,d){if(!(b instanceof d))throw new TypeError("Cannot call a class as a function");},v=function(){function b(b,c){for(var a=0;a<c.length;a++){var d=c[a];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(d,c,a){c&&b(d.prototype,c);a&&b(d,a);return d}}(),Q=function(b,d){if("function"!==
typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);b.prototype=Object.create(d&&d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(b,d):b.__proto__=d)},R=function(b,d){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?b:d},C=function(b){if(Array.isArray(b)){for(var d=0,c=Array(b.length);d<
b.length;d++)c[d]=b[d];return c}return Array.from(b)},D=function(){function b(d){p(this,b);d?(this.arr=d.split("/"),d.startsWith("/")&&(this.arr[0]="/"),d.endsWith("/")&&this.arr.pop()):this.arr=[];this.normalize()}v(b,[{key:"append",value:function(b){var c;(c=this.arr).push.apply(c,C(b.arr))}},{key:"normalize",value:function(){var b=[],c=!0,a=!1,f=void 0;try{for(var g=this.arr[Symbol.iterator](),e;!(c=(e=g.next()).done);c=!0){var h=e.value;"."!==h&&("/"===h?b=["/"]:".."===h?b.pop():b.push(h))}}catch(l){a=
!0,f=l}finally{try{!c&&g["return"]&&g["return"]()}finally{if(a)throw f;}}this.arr=b}},{key:"level",get:function(){return this.arr.length}},{key:"path",get:function(){if("/"===this.arr[0]){this.arr[0]="";var b=this.arr.join("/");this.arr[0]="/";return b}return this.arr.join("/")}},{key:"dirname",get:function(){var b=this.arr.slice(0,this.level-1);if("/"===b[0]){b[0]="";var c=b.join("/");b[0]="/";return c}return b.join("/")}},{key:"basename",get:function(){return this.arr[this.level-1]}},{key:"extname",
get:function(){var b=this.basename.split(".");return 1===b.length?"":b[b.length-1]}}]);return b}(),La=function(){function b(d,c){p(this,b);this.name=d;this.content=c}v(b,[{key:"dumps",value:function(){return JSON.stringify(this.dump(),null)}},{key:"type",get:function(){return this.content instanceof Map?"directory":"file"}}]);return b}(),Fc=function(b){function d(b){p(this,d);return R(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,""))}Q(d,b);v(d,[{key:"read",value:function(){return this.content}},
{key:"write",value:function(b){this.content=b=b.toString()}},{key:"dump",value:function(){var b=Object.create(null);b.type=this.type;b.name=this.name;b.content=this.content;return b}}]);return d}(La),Ma=function(b){function d(b){p(this,d);return R(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,null))}Q(d,b);v(d,[{key:"root",get:function(){return this}},{key:"path",get:function(){return"/"}}],[{key:"load",value:function(b){var a=new d(b.name);a.load(b.content);return a}},{key:"loads",value:function(b){return d.load(JSON.parse(b))}}]);
return d}(function(b){function d(b,a){p(this,d);var c=R(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,new Map));c.par=a;c.content.set(".",c);c.content.set("..",c.par);c.content.set("/",c.root);return c}Q(d,b);v(d,[{key:"mkdir",value:function(b){this.content.has(b)||this.content.set(b,new d(b,this));return this.content.get(b)}},{key:"touch",value:function(b){this.content.has(b)||this.content.set(b,new Fc(b));return this.content.get(b)}},{key:"rm",value:function(b){this.content.has(b)&&this.content["delete"](b)}},
{key:"ls",value:function(){var b=[],a=!0,d=!1,g=void 0;try{for(var e=this.content.keys()[Symbol.iterator](),h;!(a=(h=e.next()).done);a=!0)b.push(h.value)}catch(l){d=!0,g=l}finally{try{!a&&e["return"]&&e["return"]()}finally{if(d)throw g;}}return b}},{key:"get",value:function(b){return this.content.has(b)?this.content.get(b):!1}},{key:"mount",value:function(b,a){if(a instanceof d){var c=new d(b,this);c.content=a.content;c.content.set("..",this);c.content.set("/",this.root);this.content.set(b,c)}else this.content.set(b,
a);return this.content.get(b)}},{key:"dump",value:function(){var b=Object.create(null);b.type=this.type;b.name=this.name;b.content=[];var a=!0,d=!1,g=void 0;try{for(var e=this.content.keys()[Symbol.iterator](),h;!(a=(h=e.next()).done);a=!0){var l=h.value;"."!==l&&".."!==l&&"/"!==l&&b.content.push(this.content.get(l).dump())}}catch(t){d=!0,g=t}finally{try{!a&&e["return"]&&e["return"]()}finally{if(d)throw g;}}return b}},{key:"load",value:function(b){var a=!0,d=!1,c=void 0;try{for(var e=b[Symbol.iterator](),
h;!(a=(h=e.next()).done);a=!0){var l=h.value;"file"===l.type?this.touch(l.name).write(l.content):"directory"===l.type&&this.mkdir(l.name).load(l.content)}}catch(t){d=!0,c=t}finally{try{!a&&e["return"]&&e["return"]()}finally{if(d)throw c;}}}},{key:"root",get:function(){return this.par.root}},{key:"path",get:function(){return this.par.path+this.name+"/"}}]);return d}(La)),na=Math.max,Na="object"==typeof global&&global&&global.Object===Object&&global,Gc="object"==typeof self&&self&&self.Object===Object&&
self,ja=Na||Gc||Function("return this")(),T=ja.Symbol,Oa=Object.prototype,fb=Oa.hasOwnProperty,gb=Oa.toString,N=T?T.toStringTag:void 0,hb=Object.prototype.toString,oa=T?T.toStringTag:void 0,ka=ja["__core-js_shared__"],Pa=function(){var b=/[^.]+$/.exec(ka&&ka.keys&&ka.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),jb=Function.prototype.toString,Hc=/^\[object .+?Constructor\]$/,Ic=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,
"$1.*?")+"$"),Qa=function(){try{var b,d=null==Object?void 0:Object.defineProperty;b=(!pa(d)||Pa&&Pa in d?0:(qa(d)?Ic:Hc).test(ib(d)))?d:void 0;b({},"",{});return b}catch(c){}}(),Jc=Date.now,kb=function(b){var d=0,c=0;return function(){var a=Jc(),f=16-(a-c);c=a;if(0<f){if(800<=++d)return arguments[0]}else d=0;return b.apply(void 0,arguments)}}(Qa?function(b,d){return Qa(b,"toString",{configurable:!0,enumerable:!1,value:eb(d),writable:!0})}:ma),sa=function(b){return x(function(d){var c=d.pop();b.call(this,
d,c)})},ba="function"===typeof Symbol&&Symbol.iterator,Ra=Object.prototype,Kc=Ra.hasOwnProperty,Lc=Ra.propertyIsEnumerable,qb=ua(function(){return arguments}())?ua:function(b){return aa(b)&&Kc.call(b,"callee")&&!Lc.call(b,"callee")},pb=Array.isArray,Sa="object"==typeof A&&A&&!A.nodeType&&A,Ta=Sa&&"object"==typeof module&&module&&!module.nodeType&&module,Ua=Ta&&Ta.exports===Sa?ja.Buffer:void 0,rb=(Ua?Ua.isBuffer:void 0)||lb,ub=/^(?:0|[1-9]\d*)$/,q={};q["[object Float32Array]"]=q["[object Float64Array]"]=
q["[object Int8Array]"]=q["[object Int16Array]"]=q["[object Int32Array]"]=q["[object Uint8Array]"]=q["[object Uint8ClampedArray]"]=q["[object Uint16Array]"]=q["[object Uint32Array]"]=!0;q["[object Arguments]"]=q["[object Array]"]=q["[object ArrayBuffer]"]=q["[object Boolean]"]=q["[object DataView]"]=q["[object Date]"]=q["[object Error]"]=q["[object Function]"]=q["[object Map]"]=q["[object Number]"]=q["[object Object]"]=q["[object RegExp]"]=q["[object Set]"]=q["[object String]"]=q["[object WeakMap]"]=
!1;var Va="object"==typeof A&&A&&!A.nodeType&&A,Wa=Va&&"object"==typeof module&&module&&!module.nodeType&&module,Xa=Wa&&Wa.exports===Va&&Na.process,U;a:{try{U=Xa&&Xa.binding("util");break a}catch(b){}U=void 0}var Ya=U&&U.isTypedArray,sb=Ya?nb(Ya):mb,tb=Object.prototype.hasOwnProperty,vb=Object.prototype,xb=function(b,d){return function(c){return b(d(c))}}(Object.keys,Object),wb=Object.prototype.hasOwnProperty,Cb={},Mc=da(wa,Infinity),Nc=function(b,d,c){(Z(b)?Db:Mc)(b,d,c)},Oc=function(b){return function(d,
c,a){return b(Nc,d,c,a)}}(xa);ra(Oc);var L=ya(xa),Pc=da(L,1);ra(Pc);x(function(b,d){return x(function(c){return b.apply(null,d.concat(c))})});(function(b){return function(d,c,a){var f=-1,g=Object(d);a=a(d);for(var e=a.length;e--;){var h=a[b?e:++f];if(!1===c(g[h],h,g))break}return d}})();var Za="function"===typeof setImmediate&&setImmediate,$a="object"===typeof process&&"function"===typeof process.nextTick;Aa(Za?setImmediate:$a?process.nextTick:za);B.prototype.removeLink=function(b){b.prev?b.prev.next=
b.next:this.head=b.next;b.next?b.next.prev=b.prev:this.tail=b.prev;b.prev=b.next=null;--this.length;return b};B.prototype.empty=B;B.prototype.insertAfter=function(b,d){d.prev=b;(d.next=b.next)?b.next.prev=d:this.tail=d;b.next=d;this.length+=1};B.prototype.insertBefore=function(b,d){d.prev=b.prev;d.next=b;b.prev?b.prev.next=d:this.head=d;b.prev=d;this.length+=1};B.prototype.unshift=function(b){this.head?this.insertBefore(this.head,b):(this.length=1,this.head=this.tail=b)};B.prototype.push=function(b){this.tail?
this.insertAfter(this.tail,b):(this.length=1,this.head=this.tail=b)};B.prototype.shift=function(){return this.head&&this.removeLink(this.head)};B.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)};var Hb=da(wa,1),Qc=x(function(b){return x(function(d){var c=this,a=d[d.length-1];"function"==typeof a?d.pop():a=H;Gb(b,d,function(b,a,d){a.apply(c,b.concat([x(function(b,a){d(b,a)})]))},function(b,d){a.apply(c,[b].concat(d))})})});x(function(b){return Qc.apply(null,b.reverse())});x(function(b){var d=
[null].concat(b);return sa(function(b,a){return a.apply(this,d)})});Ba("dir");var Yb=ya(function(b,d,c,a){a=O(a||H);var f=[];b(d,function(b,a,d){c(b,function(c,e){c?d(c):(e&&f.push({index:a,value:b}),d())})},function(b){b?a(b):a(null,Fb(f.sort(function(b,a){return b.index-a.index}),Ib("value")))})});Ba("log");var u=Aa($a?process.nextTick:Za?setImmediate:za),m=function(){function b(d){p(this,b);this.car=d;this.ctx=this.cdr=null}v(b,null,[{key:"cons",value:function(d,c){var a=new b(d);a.cdr=c;return a}},
{key:"list",value:function(d){var c=null,a=!1,f=void 0,g=!0,e=!1,h=void 0;try{for(var l=d[Symbol.iterator](),k;!(g=(k=l.next()).done);g=!0){var r=k.value;a?(f.cdr=new b(r),f=f.cdr):(c=new b(r),a=!0,f=c)}}catch(w){e=!0,h=w}finally{try{!g&&l["return"]&&l["return"]()}finally{if(e)throw h;}}return c}},{key:"printList",value:function(d){for(var c="( ";d.cdr instanceof b;)c+=b.printAtom(d.car),c+=" ",d=d.cdr;c+=b.printAtom(d.car);null!==d.cdr&&(c+=" : "+b.printAtom(d.cdr));return c+" ) "}},{key:"stringify",
value:function(d){return d instanceof b?b.printList(d):d instanceof Object&&"ironsymbol"===d.type?d.symbol:JSON.stringify(d)}},{key:"printAtom",value:function(d){return d instanceof b?b.printList(d):d instanceof Object&&"ironsymbol"===d.type?d.symbol:""+d}}]);return b}(),k=function(){function b(d){p(this,b);this.symbol=d;this.type="ironsymbol"}v(b,[{key:"equal",value:function(d){return!d instanceof b?!1:d.symbol===this.symbol}},{key:"startsWith",value:function(b){return this.symbol.startsWith(b)}}]);
return b}(),F=function(){function b(d){p(this,b);this.message=d}v(b,[{key:"log",value:function(){console.log(JSON.stringify(this.message))}}]);return b}(),la=new k("__internal (any)"),J=new k("__internal (rest)"),Rc=function(){function b(){p(this,b);this.table=new Map;this.finalPointer=null}v(b,[{key:"accept",value:function(d,c){if(d instanceof m)return new F("[RHO INTERNAL] Expected an atomic value; got a LIST: "+d);var a=d;d.startsWith("@")&&(c.push(d),a=la);this.table.has(a.symbol)||this.table.set(a.symbol,
new b);return this.table.get(a.symbol)}},{key:"captureRest",value:function(d,c){c.push(d);this.table.has(J.symbol)||this.table.set(J.symbol,new b);return this.table.get(J.symbol)}},{key:"find",value:function(b,c){return b instanceof k&&this.table.has(b.symbol)?this.table.get(b.symbol):this.table.has(la.symbol)?(c.push(b),this.table.get(la.symbol)):this.table.has(J.symbol)?(c.push(J),this.table.get(J.symbol)):null}},{key:"makeFinal",value:function(b){this.finalPointer=b}}]);return b}(),Sc=function d(c,
a){p(this,d);this.params=c;this.body=a},Tc=function(){function d(c){p(this,d);this.initialState=new Rc;this.resolutionVector=[];this.size=0;this.env=c}v(d,[{key:"accept",value:function(d,a){if(!this.env.syncLock)return new F("[RHO INTERNAL] can define rewrite rules only inside a _sync block");for(var c=[],g=this.initialState,e=d;e instanceof m;){g=g.accept(e.car,c);if(g instanceof F)return g;e=e.cdr}null!==e&&e instanceof k&&e.startsWith("@")&&(g=g.captureRest(e,c));this.resolutionVector.push(new Sc(c,
a));g.makeFinal(this.size);this.size++;return!0}},{key:"find",value:function(d,a){for(var c=this.initialState,g=d,e=[];g instanceof m;){var h=g.car;h instanceof k&&h.startsWith("@")&&(h=a.get(h));c=c.find(h,e);if(null===c)break;h=e[e.length-1];if(h instanceof k&&J.equal(h)){e[e.length-1]=g;break}g=g.cdr}return null===c||null===c.finalPointer?null!==this.env.par?this.env.par.rho.find(d,a):[null,[]]:[this.resolutionVector[c.finalPointer],e]}},{key:"reduce",value:function(c,a){var f=this.find(c,a);return null===
f[0]?null:d.reduce_internal(f[0].body,f[0].params,f[1],a)}}],[{key:"reduce_internal",value:function(c,a,f,g){var e=[],h=[],l=!0,t=!1,r=void 0;try{for(var n=f[Symbol.iterator](),q;!(l=(q=n.next()).done);l=!0){var p=q.value;p instanceof k?(e.push(g.get(p)),h.push(p.symbol)):p instanceof m?(e.push(p),h.push(m.stringify(p))):(e.push(p),h.push(""+p))}}catch(ha){t=!0,r=ha}finally{try{!l&&n["return"]&&n["return"]()}finally{if(t)throw r;}}f=[];g=[];l=!0;t=!1;r=void 0;try{for(var u=a[Symbol.iterator](),v;!(l=
(v=u.next()).done);l=!0){var x=v.value;x.startsWith("@")&&(f.push(x),g.push(e.shift()),f.push(new k("@#"+x.symbol.slice(1))),g.push(h.shift()))}}catch(ha){t=!0,r=ha}finally{try{!l&&u["return"]&&u["return"]()}finally{if(t)throw r;}}a=new y(m.list(f),m.list(g),null);return d.rewrite(c,a)}},{key:"rewriteCell",value:function(c,a){if(c instanceof m){var f=new m(d.rewrite(c.car,a));f.cdr=d.rewrite(c.cdr,a);return f}return c}},{key:"rewrite",value:function(c,a){return c instanceof m?d.rewriteCell(c,a):c instanceof
k?a.get(c):c}}]);return d}(),ab=function c(){p(this,c)},ac=function(){function c(a,f){p(this,c);this.__itype__="reference";this.obj=f;for(var g=arguments.length,e=Array(2<g?g-2:0),h=2;h<g;h++)e[h-2]=arguments[h];this.keys=e;y.isEnv(f)?this.cmd="get":this.cmd=a}v(c,[{key:"get",value:function(){var a=this.obj,c=!0,g=!1,e=void 0;try{for(var h=this.keys[Symbol.iterator](),l;!(c=(l=h.next()).done);c=!0){var t=l.value;if("object"===("undefined"===typeof a?"undefined":G(a))){if(V.isCollection(a)||z.isSequence(a))a=
a.get(t);a=y.isEnv(a)?a.get(new k(t)):a[t]}else return}}catch(r){g=!0,e=r}finally{try{!c&&h["return"]&&h["return"]()}finally{if(g)throw e;}}return a}},{key:"set",value:function(a){var c=this.obj,g=!0,e=!1,h=void 0;try{for(var l=this.keys.slice(0,-1)[Symbol.iterator](),k;!(g=(k=l.next()).done);g=!0){var r=k.value;if("object"===("undefined"===typeof c?"undefined":G(c)))c=V.isCollection(c)||z.isSequence(c)?c.get(r):c[r];else return}}catch(w){e=!0,h=w}finally{try{!g&&l["return"]&&l["return"]()}finally{if(e)throw h;
}}if("object"===("undefined"===typeof c?"undefined":G(c)))return V.isCollection(c)||z.isSequence(c)?c.set(this.keys[this.keys.length-1],a):c[this.keys[this.keys.length-1]]=a,a}},{key:"value",get:function(){var a=this;if("get"===this.cmd)return this.get();if("set"===this.cmd)return function(c){return a.set(c)}}}],[{key:"isReference",value:function(a){return"object"===("undefined"===typeof a?"undefined":G(a))&&"reference"===a.__itype__}}]);return c}(),V=function(c){function a(c){p(this,a);var f=R(this,
(a.__proto__||Object.getPrototypeOf(a)).call(this));f.__itype__="collection";f.obj=c?c:Object.create(null);f.has=function(a){return void 0!==f.obj[a]};f.get=function(a){if("string"===typeof a&&f.has(a))return f.obj[a]};f.set=function(a,c){if("string"===typeof a)return f.obj[a]=c,f.obj};return f}Q(a,c);v(a,null,[{key:"isCollection",value:function(a){return"object"===("undefined"===typeof a?"undefined":G(a))&&"collection"===a.__itype__}}]);return a}(ab),z=function(c){function a(c){p(this,a);var f=R(this,
(a.__proto__||Object.getPrototypeOf(a)).call(this));f.__itype__="sequence";f.arr=c?c:[];f.get=function(a){if(parseInt(a)===Number(a))return f.arr[a]};f.set=function(a,c){if(parseInt(a)===Number(a))return f.arr[a]=c,f.arr};f.push=function(a){f.arr.push(a);return a};f.pull=function(){return f.arr.shift()};f.pop=function(){return f.arr.pop()};return f}Q(a,c);v(a,null,[{key:"isSequence",value:function(a){return"object"===("undefined"===typeof a?"undefined":G(a))&&"sequence"===a.__itype__}}]);return a}(ab),
y=function(){function c(a,f,g){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!1;p(this,c);this.__itype__="env";this.map=new Map;this.par=g;this.syncLock=!0;this.bind(a,f);this.syncLock=!1;this.rho=new Tc(this);this.symtab=new Map;this.collection=e?new V:this.par?this.par.collection:null}v(c,[{key:"sync",value:function(){this.syncLock=!0}},{key:"unsync",value:function(){this.syncLock=!1}},{key:"syncAndBind",value:function(a,c){var f=!1;this.syncLock||(this.sync(),f=!0);this.bind(a,c);
f&&this.unsync()}},{key:"bind",value:function(a,c){if(!this.syncLock)return!1;for(;a instanceof m;)c instanceof m?(this.bind(a.car,c.car),a=a.cdr,c=c.cdr):(this.bind(a.car,void 0),a=a.cdr);null!==a&&(ea(a instanceof k,""+m.stringify(a)+" is not an IronSymbol"),this.map.set(a.symbol,c));return!0}},{key:"__internal_find",value:function(a){ea(a instanceof k,""+a+" is not an IronSymbol");return this.map.has(a.symbol)?this:this.par.find(a)}},{key:"find",value:function(a){return this.__internal_find(a)}},
{key:"__internal_get",value:function(a){ea(a instanceof k,""+a+" is not an IronSymbol");var c=a.symbol;return this.map.has(c)?this.map.get(c):null!==this.par?this.par.get(a):a}},{key:"get",value:function(a){return this.__internal_get(a)}},{key:"getAsync",value:function(a,c){c(null,this,null,this.__internal_get(a))}},{key:"defc",value:function(a,c){this.symtab.set(a,c);return c}},{key:"getc",value:function(a){return this.symtab.has(a)?this.symtab.get(a):null!==this.par?this.par.getc(a):null}}],[{key:"isEnv",
value:function(a){return"object"===("undefined"===typeof a?"undefined":G(a))&&"env"===a.__itype__}},{key:"clone",value:function(a){var f=new c(null,null,a.par);f.map=a.map;f.rho=a.rho;f.symtab=a.symtab;f.collection=a.collection;return f}}]);return c}(),I=function(){function c(a,f){var g=this;p(this,c);this.__itype__="stream";this.env=f;this.core=a;this.value=void 0;this.callbacks=[];this.addcb=function(a){g.callbacks.push(a)};this.push=function(a){g.value=a;if(null!==a&&void 0!==a){var c=!0,f=!1,
e=void 0;try{for(var k=g.callbacks[Symbol.iterator](),m;!(c=(m=k.next()).done);c=!0)u(m.value,null,g.env,null,a)}catch(E){f=!0,e=E}finally{try{!c&&k["return"]&&k["return"]()}finally{if(f)throw e;}}}};u(this.core,function(a){g.value=a;if(null!==a&&void 0!==a){var c=!0,f=!1,e=void 0;try{for(var k=g.callbacks[Symbol.iterator](),m;!(c=(m=k.next()).done);c=!0)u(m.value,null,g.env,null,a)}catch(E){f=!0,e=E}finally{try{!c&&k["return"]&&k["return"]()}finally{if(f)throw e;}}}})}v(c,null,[{key:"isStream",value:function(a){return a instanceof
Object&&"stream"===a.__itype__}}]);return c}(),Kb=new k("_dot"),vc=new k("_egg"),Ub=new k("_cons"),Ca=new k("_car"),Da=new k("_cdr"),Sb=new k("_quote"),$b=new k("_dot"),Tb=new k("_"),bc=new k("_if"),ec=new k("_def"),fc=new k("_let"),gc=new k("_assign!"),hc=new k("_set!"),jc=new k("_fn"),Fa=new k("_fr"),Ha=new k("_begin"),lc=new k("_sync"),mc=new k("_module"),kc=new k("_rho"),cc=new k("_try"),dc=new k("_err"),Nb=new k("_self"),Ob=new k("_this"),Pb=new k("NIL"),Qb=new k("_true"),Rb=new k("_false"),
ia=new k("_coll"),Vb=new k("_seq"),Ea=new k("_map"),Wb=new k("_filter"),ic=new k("_push"),pc=new k("_pull"),qc=new k("_pop"),nc=new k("_stream"),rc=new k("_do"),oc=new k("_on"),Ia=new k("_include"),tc=new k("_use"),uc=new k("_import"),wc=new k("_volatile"),P=function(c,a){return function(f,g){n(f,c,function(c,f,l,k){a?u(g,c,k):g(c,k)})}},sc=function(){return function(c){c&&c instanceof F&&c.log()}},Mb=function(){return function(c){c||console.timeEnd("Runtime")}},Uc=function(){function c(a){p(this,
c);this.pos=0;this.line=1;this.col=0;this.buffer=a.buffer;this.name=a.name}v(c,[{key:"next",value:function(){var a=this.buffer.charAt(this.pos++);"\n"==a?(this.line++,this.col=0):this.col++;return a}},{key:"peek",value:function(){return this.buffer.charAt(this.pos)}},{key:"eof",value:function(){return""===this.peek()}},{key:"error",value:function(a){console.log(a+" @ "+this.name+" ("+this.line+":"+this.col+")");throw Error("Ironscript CompileTime Error");}}]);return c}(),W=function(){function c(a){p(this,
c);this.source=new Uc(a);this.current=null}v(c,[{key:"readString",value:function(){for(var a="";!this.source.eof();){var c=this.source.next();if("\\"==c)'"'==this.source.peek()?a+=this.source.next():"n"==this.source.peek()?(this.source.next(),a+="\n"):"t"==this.source.peek()?(this.source.next(),a+="\t"):a+=c;else if('"'==c)break;else a+=c}return a}},{key:"readSymbol",value:function(a){for(;!this.source.eof();){var f=this.source.peek();if(c.isOp(f)||c.isSpace(f)||'"'==f)break;a+=this.source.next()}return new k(a)}},
{key:"readSpecial",value:function(a){for(var c="";!this.source.eof();){var g=this.source.next();if(g==a)if("@"==this.source.peek()){this.source.next();break}else c+=g;else c+=g}return c}},{key:"readComment",value:function(){for(this.source.next();!this.source.eof()&&"\n"!==this.source.peek();)this.source.next()}},{key:"readNext",value:function(){for(;!this.source.eof()&&c.isSpace(this.source.peek());)this.source.next();if(this.source.eof())return null;var a=this.source.peek();if(";"==a)return this.readComment(),
this.readNext();if(c.isOp(a))return this.source.next();if('"'==a)return this.source.next(),this.readString();if("@"==a){var f=this.source.next();if("{"==this.source.peek()){this.source.next();f=this.readSpecial("}");try{return yc(new Function("$return","$throw","$catch","$yield","$scope","...args",f+";$return(null);"))}catch(w){throw console.error(f),w;}}else return"["==this.source.peek()?(this.source.next(),this.readSpecial("]")):this.readSymbol(f)}else{var g=this.readSymbol("");if(isNaN(Number(g.symbol))){a=
g.symbol.split(".");if(1===a.length)return g;a[0]=""===a[0]?new k("_this"):new k(a[0]);var g=[],e=!0,h=!1,l=void 0;try{for(var f=a[Symbol.iterator](),m;!(e=(m=f.next()).done);e=!0){var r=m.value;isNaN(Number(r))?g.push(r):g.push(Number(r))}}catch(w){h=!0,l=w}finally{try{!e&&f["return"]&&f["return"]()}finally{if(h)throw l;}}return g}return Number(g.symbol)}}},{key:"next",value:function(){var a=this.current;this.current=null;return null===a?this.readNext():a}},{key:"peek",value:function(){null===this.current&&
(this.current=this.readNext());return this.current}},{key:"eof",value:function(){return null===this.peek()}},{key:"error",value:function(a){this.source.error(a+' near "'+this.current+'" ')}}],[{key:"isSpace",value:function(a){return 0<=" \t\n".indexOf(a)}},{key:"isOp",value:function(a){return/[\(\)\{\}\[\]\':]/g.test(a)}},{key:"eps",get:function(){return""}}]);return c}(),M=function(){function c(a){p(this,c);this.lex=new W(a);this.root=this.parseList()}v(c,[{key:"parse",value:function(){return this.root}},
{key:"parseList",value:function(a){var c=this.parseAtom();if(c===a||c===W.eps)return null;for(var g=new m(c),e=g,c=this.parseAtom();c!==a&&c!==W.eps;){")"!==c&&"]"!==c&&"}"!==c||this.error("Parenthesis/Bracket/Brace mismatch");if(":"===c){c=this.parseAtom();e.cdr=c;this.parseAtom()!==a&&this.error(a+" required here !");break}else e.cdr=new m(c);e=e.cdr;c=this.parseAtom()}return g}},{key:"parseAtom",value:function(){if(this.lex.eof())return W.eps;var a=this.lex.next();if("("===a)return this.parseList(")");
if("'"===a)return m.cons(new k("_quote"),new m(this.parseAtom()));if("["===a)return m.cons(new k("_self"),this.parseList("]"));if("{"===a)return m.cons(new k("_coll"),this.parseList("}"));a instanceof Array&&(a=m.cons(new k("_dot"),m.list(a)),a.ctx="get");return a}},{key:"error",value:function(a){this.lex.error("[SYNTAX ERROR] "+a)}}]);return c}(),Vc=function(c){return function(a,f,g,e,h){h||(h="unnamed");a=new M({name:h,buffer:e});u(n,a.parse(),c,function(a,c,e,h){g&&u(g,a,f,null,c)})}},Wc=function(){var c=
new y(null,null,null,!0);c.sync();c.bind(new k("_fx"),xc);c.bind(new k("_eval!"),zc);c.bind(new k("_echo"),Ja(Bc));c.bind(new k("_new"),Ja(function(a){for(var c=arguments.length,g=Array(1<c?c-1:0),e=1;e<c;e++)g[e-1]=arguments[e];return new (Function.prototype.bind.apply(a,[null].concat(g)))}));c.unsync();return c},Ka=new k("_readsource"),Xc=function(c){function a(a,e,h,k){a=e.getc("__base_dir__");a.startsWith("/")||(a=K(c.pwd,a));(a=c.readFile(K(a,k)))||u(h,"could not read file "+k);u(h,null,f,null,
a)}var f=Wc();f.defc("__base_dir__",c.basedir);f.defc("__readfile__",c.readFile);f.defc("__include_dir__",K(c.rootdir,"include"));f.defc("imports",window);f.defc("__path_utils__",{join:K,dirname:S,basename:X,extname:bb});f.sync();f.bind(new k("_readfile"),a);f.bind(new k("_readsource"),a);f.bind(new k("_import"),Cc(f));f.bind(new k("_include"),Dc(f));f.bind(new k("_eval"),Vc(f));f.unsync();return f},Yc=function(){function c(){p(this,c);this.cwd=this.root=new Ma("root")}v(c,[{key:"context",value:function(a){return{rootdir:this.root.path,
basedir:a,pwd:this.pwd,readFile:this.readFile,open:this.open,cwd:this.cwd}}},{key:"run",value:function(a){var c=this.readFile(a);Ac(c,a,Xc(this.context(S(a))))}},{key:"mkdir",value:function(a){var c=this.cwd;a=new D(a);var g=0,e=!0,h=!1,k=void 0;try{for(var m=a.arr[Symbol.iterator](),n;!(e=(n=m.next()).done);e=!0){var p=n.value,q=c.get(p);q?c=q:(c=c.mkdir(p),g+=1)}}catch(Lb){h=!0,k=Lb}finally{try{!e&&m["return"]&&m["return"]()}finally{if(h)throw k;}}return g}},{key:"resolve",value:function(a){var c=
this.cwd;a=new D(a);var g=!0,e=!1,h=void 0;try{for(var k=a.arr[Symbol.iterator](),m;!(g=(m=k.next()).done);g=!0){var n=c.get(m.value);if(!n||"directory"!==n.type)return!1;c=n}}catch(w){e=!0,h=w}finally{try{!g&&k["return"]&&k["return"]()}finally{if(e)throw h;}}return c}},{key:"cd",value:function(a){a=this.resolve(a);if(!a)return!1;this.cwd=a;return!0}},{key:"mount",value:function(a,c){var f=S(a),e=X(a);this.resolve(f).mount(e,c)}},{key:"touch",value:function(a){this.cwd.touch(a)}},{key:"open",value:function(a){var c=
this.cwd,g=K(this.pwd,a),g=new D(S(g)),e=!0,h=!1,k=void 0;try{for(var m=g.arr[Symbol.iterator](),n;!(e=(n=m.next()).done);e=!0){var p=c.get(n.value);if(!p||"directory"!==p.type)return null;c=p}}catch(E){h=!0,k=E}finally{try{!e&&m["return"]&&m["return"]()}finally{if(h)throw k;}}return(a=c.get(X(a)))&&"file"===a.type?a:null}},{key:"readFile",value:function(a){return(a=this.open(a))?a.content:null}},{key:"pwd",get:function(){return this.cwd.path}}]);return c}(),Zc=function(){function c(a){var f=this;
p(this,c);var g=JSON.parse(a);a=g.rootfs;g=g.config;this.main=K("/bundle",g.main);this.jsImports=g.imports;this.runtime=new Yc;this._loadlock=this.jsImports.length;a=Ma.loads(a);this.runtime.mount("/bundle",a.get("bundle"));this.runtime.mount("/include",a.get("include"));if(this.jsImports&&0!==this.jsImports.length){a=!0;var g=!1,e=void 0;try{for(var h=this.jsImports[Symbol.iterator](),k;!(a=(k=h.next()).done);a=!0)Ec(k.value.url,function(a){document.getElementsByTagName("head")[0].removeChild(a);
--f._loadlock;0===f._loadlock&&f.run()})}catch(t){g=!0,e=t}finally{try{!a&&h["return"]&&h["return"]()}finally{if(g)throw e;}}}else this.run()}v(c,[{key:"run",value:function(){this.runtime.run(this.main);return null}}]);return c}();A.runPackage=function(c){console.log("Powered by Ironscript 1.2.2");console.log("visit https://ironscript.gitgub.io for more info");new Zc(c)}})(this.ironscript=this.ironscript||{});